<!DOCTYPE html>
<!--
SOURCES:
http://www.html5canvastutorials.com/advanced/html5-canvas-ovals/

We used this to figure how to create ovals - namely by using the scale method. 

-->

<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<title>Puppet Maestro</title>

<script src="https://js.leapmotion.com/leap-0.6.4.js"></script>
<script src="https://js.leapmotion.com/leap-plugins-0.1.11.js"></script>
<!-- <script src="https://js.leapmotion.com/leap-widgets-0.1.0.js"></script>
<script src="https://js.leapmotion.com/leap.rigged-hand-0.1.7.js"></script>
<script src="https://js.leapmotion.com/leap-plugins-0.1.11-utils.js"></script> -->
</head>

<body>
<canvas id="scene"></canvas>
<script>

// Get the canvas and a 2-dimensional drawing context
var canvas = document.getElementById('scene');

//Ask why moving these instructions from header to here made a difference
canvas.width = window.innerWidth;
canvas.height = window.innerHeight; 
var ctx = canvas.getContext('2d');   
// Get the canvas width and height
var width = canvas.width, height = canvas.height;

// Name some colors
var red = '#F00', green = '#0F0', blue = '#00F', purple = '#A0F';
// Create an array to save circle properties
var circles = [ ];

function drawCircle(center, radius, color, fill, scaleX, scaleY) {
  // Make an closed arc with a complete rotation
  ctx.scale(scaleX, scaleY); 
  ctx.beginPath();
  ctx.arc(width/2, height/2, radius, 0, 2*Math.PI);
  ctx.stroke();  
  ctx.lineWidth = 4;
  // Choose whether to fill or outline the circle
  if (fill) {
    ctx.fillStyle = color;
    ctx.fill();
  } else {
    ctx.strokeStyle = color;
    ctx.stroke();
  }
}

// Create a Leap controller to access frame data
var controller = new Leap.Controller();

// Register a callback to process frame data
controller.on('frame', function(frame) {
  // Clear the canvas so we can repaint
  ctx.clearRect(0, 0, width, height);
  
  //Make sure we have accumulated at most 200 circles
  if (circles.length > 5) {
    circles = circles.slice(-5); // Last 200 circles
  } //probably for fading 
  
  
  // Draw finger tips as colored circles
  for (var h = 0; h < frame.hands.length; h = h+1) {
    var hand = frame.hands[h];
    // Calculate the circle center and radius
    //var center = leapToScene(hand.palmPosition);
   
   
    var radius = Math.abs(hand.palmPosition[1]);
    
    color = green; 
    fill = true;

    if(hand.grabStrength > 0.8) {
    color = red;
   
    }

    
    
    /*
    Take care to make sure that actions are supposed to be distinct  actually 
    are distinct- i.e - color change and unfill don't happen at the same time.  
    */
    if(hand.roll() > 2) {
    fill = false; 
    
    }

    drawCircle([width/2, height/2], radius, color, fill,1,1);
    
  }
  
});

// Connect the controller to start receiving data
controller.connect();

</script>

</body>
</html>